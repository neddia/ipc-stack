version: 2

site_agent:
  service_active: true

  gatewayd:
    base_url: "http://gatewayd:8080"
    auth:
      mode: "token"
      token: "${GATEWAYD_TOKEN}"

  telemetry:
    poll_s: 5

  vfd_power_model:
    measurement: vfd_telemetry
    hz_field: out_hz
    kw_field: kw
    defaults:
      base_hz: 60
      motor_eff: 0.90
      vfd_eff: 0.98
      idle_w: 30
      cal: { hz1: 30, kw1: 0.2, hz2: 60, kw2: 0.6 }

  miners:
    scan_enabled: true
    scan_every_s: 300
    poll_every_s: 60
    timeout_ms: 800
    concurrency: 64
    influx_bucket: edge-site
    ip_ranges: []
    groups: []

  device_discovery:
    enabled: false
    scan_every_s: 60
    scan_timeout_ms: 800
    scan_concurrency: 128
    ip_ranges: []
    targets: []

  control:
    hz_min: 35
    hz_max: 60
    hz_step: 1.0
    optimize_every_s: 60
    lookback_fit: "60m"
    slope_window_min: 45
    fan95_cap: 0.70
    hotspot_frac_threshold: 0.05
    hotspot_max_up_hz: 1.0
    ramp_hz: 4.0
    deadband_hz: 0.5
    min_dJ_frac: 0.005
    bootstrap_hz: 50
    default_slope: -0.008
    slope_min: -0.05
    slope_max: -0.001

  physics:
    gamma: 1.0
    baseline_w: 0.0
    fan_power_scale: 1.0

gatewayd:
  node_id: "${GATEWAYD_NODE_ID}"
  db_path: "storage/gatewayd.sqlite3"
  profiles_dir: "storage/profiles"
  northbound:
    host: "0.0.0.0"
    port: 8080
    auth:
      mode: "token"
      token: "${GATEWAYD_TOKEN}"
  policy:
    lease_ttl_s: 10
    safe_after_s: 15
    tick_s: 1.0
    restore_on_present: true
    hz_epsilon: 0.5
    run_infer_min_hz: 1.0
    reapply_min_s: 2.0
    reapply_max_s: 120.0

fans: []

# Example fan (enable and edit for your hardware):
# - id: "fan1"
#   authority_mode: "direct"
#   safe: { enabled: true, hz: 45.0, run: true }
#   restore: { mode: "last" }
#   maint_default: false
#   driver:
#     kind: "modbus"
#     transport: "tcp"
#     host: "192.168.1.10"
#     port: 502
#     timeout_s: 1.0
#     unit_id: 1
#     profile: "generic_vfd"
